syntax = "proto3";

option ruby_package = "Tucana::Aquila";

package aquila;

import "shared.struct.proto";

// Event that gets admitted by an action
message Event {
  // Id of Event type
  string event_type = 1;
  // Payload (JSON) of event params
  shared.Value payload = 2;
}

// Action flow/event configuration
message ActionLogon {
  // Action identifier
  string action_identifier = 1;
  string version = 2;
}

// Request to execute a request a flow
message ExecutionRequest {
  // Execution identifier of execution
  string execution_identifier = 1;
  // Function identifier of flow to execute
  string function_identifier = 2;
  // Parameters (JSON) of flow required to execute
  shared.Struct parameters = 3;
}

// Result from executed flows by an action
message ExecutionResult {
  // Identifier of flow to execute
  string execution_identifier = 1;
  // Result of executed flow
  shared.Value result = 2;
}

message TransferRequest {
  oneof data {
    // Identification of the action
    //
    // Expected behavior:
    // Aquila will abort if the first request is not an ActionLogon
    ActionLogon logon = 1;
    // Event that got admitted
    Event event = 2;
    // Result of execution that was triggered by a execution request
    ExecutionResult result = 3;
  }
}

message TransferResponse {
  // Execution request
  ExecutionRequest execution = 1;
}

service ActionTransferService {
  // This behavior achieves a bi-directional stream so that both services aren't required to be a server & client on their own
  rpc Transfer (stream TransferRequest) returns (stream TransferResponse);
}
