syntax = "proto3";

option ruby_package = "Tucana::Sagittarius";

package sagittarius;

import "shared.struct.proto";

message Logon {}

message TestExecutionRequest {
    int64 flow_id = 1;
    string execution_uuid = 2;
    shared.Value body = 3;
}

message TestExecutionResponse {
    int64 flow_id = 1;
    string execution_uuid = 2;
    shared.Value result = 3;
    repeated Log logs = 4;
}

message Log {
  oneof kind {
    ApplicationLog application_log = 1;
    SuccessLog success_log = 2;
    RuntimeErrorLog error_log = 3;
  }
}

message SuccessLog {
  int64 note_id = 1;
  shared.Value result = 2;
}

message RuntimeErrorLog {
  int64 note_id = 1;
  string error_code = 2;
  string error_message = 3;
  optional string suggestion = 4;
}

message ApplicationLog {
    string message = 1;
    string level = 2;
    string timestamp = 3;
}

// Aquila sends a logon request to Sagittarius that initiates a stream
// If the stream is initialized it will return the result after it received a request
message ExecutionLogonRequest {
    oneof data {
        Logon logon = 1;
        TestExecutionResponse response = 2;
    }
}

// Sagittarius sends execution requests
message ExecutionLogonResponse {
  TestExecutionRequest request = 1;
}

service ExecutionService {
  rpc Test (stream ExecutionLogonRequest) returns (stream ExecutionLogonResponse) {}
}
