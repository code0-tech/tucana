syntax = "proto3";

option ruby_package = "Tucana::Shared";

package shared;

import "shared.struct.proto";
import "shared.data_type.proto";

message ValidationFlow {
  // Database ID -> req. for Aquila to identify in FlowStore
  int64 flow_id = 1;
  int64 project_id = 2;
  // The FlowType´s identifier
  string type = 3;
  // All custom data types used in this flow
  repeated shared.ExecutionDataType data_types = 4;
  // These reference data_types by its identifiers, which is are string
  optional shared.DataTypeIdentifier input_type = 5;
  optional shared.DataTypeIdentifier return_type = 6;
  repeated FlowSetting settings = 7;
  int64 starting_node_id = 8;
  repeated NodeFunction node_functions = 9;
  string project_slug = 10;
  optional string disable_reason = 11;
}

message ExecutionFlow {
  // Database ID -> req. for Aquila to identify in FlowStore
  int64 flow_id = 1;
  int64 starting_node_id = 2;
  repeated NodeFunction node_functions = 4;
  optional shared.Value input_value = 3;
}

message FlowSetting {
  // The database id from sagittarius
  int64 database_id = 1;
  string flow_setting_id = 2;
  shared.Value value = 3;
}

message NodeFunction {
  // The database id from sagittarius
  int64 database_id = 1;
  string runtime_function_id = 2;
  repeated NodeParameter parameters = 3;
  optional int64 next_node_id = 4;
  string definition_source = 5;
}

message NodeValue {
  oneof value {
    shared.Value literal_value = 1;
    ReferenceValue reference_value = 2;
    // Reference to the `database_id` field of message `NodeFunction`
    int64 node_function_id = 3;
  }
}

message NodeParameter {
  // The database id from sagittarius
  int64 database_id = 1;
  string runtime_parameter_id = 2;
  NodeValue value = 3;
}

message ReferenceValue {
  // Database Identifier of node
  int64 node_id = 1;
  repeated ReferencePath paths = 2;
}

message ReferencePath {
  optional string path = 1;
  optional int64 array_index = 2;
}

// Used in sagittarius´s FlowService because oneof can only
// take in a single message type and not a repeated one
message Flows {
  repeated ValidationFlow flows = 1;
}
